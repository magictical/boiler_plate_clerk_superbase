---
name: RB-02 AI 코치 MVP
overview: Gemini API를 활용한 AI 코치 채팅 인터페이스와 루틴 제안 기능을 구현합니다.
status: 진행 중
todo_ref: docs/TODO.md § 4.2
---

# RB-02: AI 코치 (AI Coach) MVP 구현 계획

> **상태**: 진행 중 (TODO 4.2)  
> **관리 위치**: `docs/implementation-plans/`

---

## 1. 요구사항 정리

| 출처 | 내용 |
|------|------|
| PRD 3.2 | Context 주입(티어, 체중, 로그), 채팅 인터페이스, 루틴 제안 카드, 빌더로 가져오기. |
| TODO 4.2 | `app/routine-builder/ai-coach/page.tsx`, `AIChat.tsx`, `RoutineSuggestionCard.tsx`, `actions/ai.ts`. |
| Design Ref 09 | 채팅 UI(말풍선), 퀵 리플라이 칩, 제안 카드(이미지, 요약, 버튼), 입력창. |
| Userflow | AI Coach -> Context 주입 -> Gemini API -> 제안 카드 -> 빌더 로드. |

---

## 2. 아키텍처 및 데이터 흐름

```mermaid
flowchart TD
    subgraph Client ["Client Side"]
        A[AIChat Component] -->|User Message| B[Server Action]
        A -->|Quick Reply| B
        B -->|Response| A
        A -->|Render| C[RoutineSuggestionCard]
        C -->|Click Import| D[Load to Builder (State/Store)]
    end

    subgraph Server ["Server Side (actions/ai.ts)"]
        B[generateRoutineAction] --> E[Fetch User Context]
        E -->|Tier, Weight| F[Supabase (users)]
        B -->|Prompt| G[Gemini API]
        G -->|JSON| B
    end
```

---

## 3. 구현 범위

### 3.1 Server Actions (`actions/ai.ts`)
- **`generateRoutineAction(message: string)`**:
  1. `auth()` 체크.
  2. `users` 테이블에서 `current_tier`, `weight_kg` 조회.
  3. `training_logs`에서 최근 기록 조회 (MVP는 placeholder).
  4. `lib/ai/gemini.ts`의 `buildRoutinePrompt` 및 `generateRoutineContent` 호출.
  5. 결과 반환 (AI 메시지 + 루틴 JSON).

### 3.2 컴포넌트
- **`components/routine-builder/RoutineSuggestionCard.tsx`**:
  - 루틴 요약 정보 표시 (예상 시간, 강도 - JSON 분석).
  - "빌더로 가져오기" 버튼 -> `localStorage` 또는 상태 관리(Zustand)에 저장 후 `/routine-builder/editor`로 이동. (MVP는 `localStorage` 사용 권장).
- **`components/routine-builder/AIChat.tsx`**:
  - 메시지 목록 상태 관리.
  - 퀵 리플라이 칩 구현.
  - 스크롤 자동 이동.
  - 로딩 인디케이터.

### 3.3 페이지
- **`app/routine-builder/ai-coach/page.tsx`**: `AIChat` 컴포넌트 래핑.

---

## 4. 작업 순서

1. `actions/ai.ts` 구현 (Context 조회 및 Gemini 호출).
2. `components/routine-builder/RoutineSuggestionCard.tsx` 구현.
3. `components/routine-builder/AIChat.tsx` 구현.
4. `app/routine-builder/ai-coach/page.tsx` 구현.
